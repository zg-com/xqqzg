<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é˜¿å·´é˜¿å·´é˜¿å·´ ğŸ </title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        /* --- æ ·å¼ä¿æŒä¸å˜ --- */
        :root {
            --primary: #6c5ce7;
            --bg: #f8f9fd;
            --card-bg: #ffffff;
        }
        body { margin: 0; padding: 0; font-family: 'PingFang SC', sans-serif; background: var(--bg); color: #2d3436; }
        
        /* é¡¶éƒ¨å¤§å¡ç‰‡ */
        .hero {
            background: linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%);
            padding: 40px 20px; color: white; border-bottom-left-radius: 30px; border-bottom-right-radius: 30px;
            box-shadow: 0 10px 20px rgba(161, 140, 209, 0.3); text-align: center;
        }
        .hero h1 { margin: 0; font-size: 26px; }
        .hero p { opacity: 0.9; margin-top: 10px; font-size: 14px; }

        .container { max-width: 600px; margin: 0 auto; padding: 20px; }

        /* --- å¯¼èˆªç½‘æ ¼ --- */
        .nav-grid {
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;
            transform: translateY(-30px); margin-bottom: 0;
        }
        .nav-item {
            background: white; border-radius: 16px; padding: 15px 10px;
            text-align: center; text-decoration: none; color: #333;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05); transition: 0.2s;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .nav-item:active { transform: scale(0.95); }
        .nav-icon { font-size: 28px; margin-bottom: 5px; }
        .nav-text { font-size: 13px; font-weight: bold; }

        /* --- è¿›åº¦æ¡å¡ç‰‡ --- */
        .section-title { font-weight: bold; font-size: 18px; margin: 20px 0 15px; display: flex; justify-content: space-between; align-items: center; }
        .add-btn { font-size: 12px; background: #dfe6e9; padding: 5px 12px; border-radius: 20px; cursor: pointer; }
        
        .goal-card {
            background: white; border-radius: 16px; padding: 20px;
            margin-bottom: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.03);
            position: relative;
        }
        
        .goal-header { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 15px; font-weight: bold; }
        .goal-val { color: var(--primary); }
        
        .progress-bg { height: 10px; background: #f1f2f6; border-radius: 5px; overflow: hidden; position: relative; }
        .progress-bar { 
            height: 100%; background: linear-gradient(90deg, #6c5ce7, #a29bfe); 
            border-radius: 5px; width: 0%; transition: width 1s ease;
        }
        
        .goal-footer { 
            margin-top: 8px; font-size: 12px; color: #b2bec3; 
            display: flex; justify-content: space-between; 
        }

        /* ç®€å•çš„æ“ä½œæŒ‰é’® */
        .action-row { margin-top: 15px; text-align: right; border-top: 1px dashed #eee; padding-top: 10px; }
        .sm-btn { font-size: 12px; color: #636e72; margin-left: 10px; cursor: pointer; }

        /* --- å¼¹çª—æ ·å¼ --- */
        .modal-mask {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center;
            z-index: 999;
        }
        .modal { background: white; padding: 20px; border-radius: 16px; width: 80%; max-width: 320px; }
        .form-item { margin-bottom: 15px; }
        .form-item label { display: block; margin-bottom: 5px; font-size: 14px; color: #666; }
        .form-item input { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        .btn-submit { width: 100%; padding: 10px; background: var(--primary); color: white; border: none; border-radius: 8px; font-weight: bold; }
    </style>
</head>
<body>

<div id="app">
    <div class="hero">
        <h1>Welcome Back â¤ï¸</h1>
        <p>ä»Šå¤©æ˜¯çˆ±ä½ çš„ç¬¬ {{ daysInLove }} å¤©</p>
    </div>

    <div class="container">
        <div class="nav-grid">
            <a href="unit/coupons.html" class="nav-item">
                <span class="nav-icon">ğŸŸï¸</span>
                <span class="nav-text">å…‘æ¢åˆ¸</span>
            </a>
            <a href="unit/decision.html" class="nav-item">
                <span class="nav-icon">ğŸ¡</span>
                <span class="nav-text">å¸®æˆ‘é€‰</span>
            </a>
            <a href="unit/daoqian.html" class="nav-item">
                <span class="nav-icon">ğŸ¥º</span>
                <span class="nav-text">å°å‰§åœº</span>
            </a>
        </div>

        <div class="section-title">
            <span>ğŸ“ˆ æˆ‘ä»¬çš„æˆé•¿è®¡åˆ’</span>
            <span class="add-btn" @click="openModal()">+ æ–°å»º</span>
        </div>

        <div v-if="goals.length === 0" style="text-align:center; color:#ccc; padding:20px;">
            åŠ è½½æ•°æ®ä¸­... (å¦‚æœæ²¡æœ‰æ˜¾ç¤ºï¼Œè¯´æ˜åç«¯æ²¡è¿ä¸Šï¼Œä¼šè‡ªåŠ¨æ˜¾ç¤ºæ¼”ç¤ºæ•°æ®)
        </div>

        <div class="goal-card" v-for="goal in goals" :key="goal.id">
            <div class="goal-header">
                <span>{{ goal.title }}</span>
                <span class="goal-val">{{ goal.currentVal }} / {{ goal.targetVal }} {{ goal.unit }}</span>
            </div>
            
            <div class="progress-bg">
                <div class="progress-bar" :style="{ width: getPercent(goal) + '%' }"></div>
            </div>

            <div class="goal-footer">
                <span>è¿›åº¦: {{ getPercent(goal) }}%</span>
                <span>ç›®æ ‡: {{ goal.targetVal }} {{ goal.unit }}</span>
            </div>

            <div class="action-row">
                <span class="sm-btn" @click="openModal(goal)">âœï¸ æ›´æ–°è¿›åº¦</span>
                <span class="sm-btn" @click="deleteGoal(goal.id)" style="color:#ff7675;">ğŸ—‘ï¸ åˆ é™¤</span>
            </div>
        </div>
    </div>

    <div class="modal-mask" v-if="showModal" @click.self="showModal=false">
        <div class="modal">
            <h3 style="margin-top:0">{{ form.id ? 'æ›´æ–°è¿›åº¦' : 'æ–°å»ºç›®æ ‡' }}</h3>
            
            <div class="form-item">
                <label>ç›®æ ‡åç§°</label>
                <input v-model="form.title" placeholder="ä¾‹å¦‚ï¼šæ”’é»„é‡‘">
            </div>
            <div class="form-item">
                <label>å½“å‰æ•°å€¼</label>
                <input type="number" v-model="form.currentVal" placeholder="0">
            </div>
            <div class="form-item">
                <label>ç›®æ ‡æ€»æ•°</label>
                <input type="number" v-model="form.targetVal" placeholder="100">
            </div>
            <div class="form-item">
                <label>å•ä½</label>
                <input v-model="form.unit" placeholder="ä¾‹å¦‚ï¼šå…‹">
            </div>

            <button class="btn-submit" @click="submitForm">ä¿å­˜</button>
        </div>
    </div>
</div>

<script>
    const { createApp, ref, onMounted, computed } = Vue;
    // âš ï¸ æ³¨æ„ï¼šè¿™é‡Œæ˜¯ä½ åç«¯çš„åœ°å€ã€‚
    // å¦‚æœä½ åœ¨æœ¬åœ°è°ƒè¯•åç«¯ï¼Œå¯èƒ½éœ€è¦æ”¹æˆ 'http://localhost:8080'
    const API_BASE = 'https://darlingweb.onrender.com';

    createApp({
        setup() {
            // âœ… ä¿®æ”¹ç‚¹ 1ï¼šè®¾ç½®æ‹çˆ±çºªå¿µæ—¥
            // åªè¦æŠŠè¿™é‡Œæ”¹æˆä½ ä»¬åœ¨ä¸€èµ·çš„æ—¥æœŸï¼ŒVue ä¼šè‡ªåŠ¨æ‹¿â€œä»Šå¤© - è¿™ä¸ªæ—¥æœŸâ€ï¼Œæ— è®ºæ˜å¤©è¿˜æ˜¯æ˜å¹´æ‰“å¼€ï¼Œå®ƒéƒ½ä¼šå˜ã€‚
            const startData = new Date('2025-09-25'); 
            
            // è®¡ç®—å¤©æ•°çš„é€»è¾‘ï¼ˆè‡ªåŠ¨è·å–å½“å‰æ—¶é—´ new Date()ï¼‰
            const now = new Date();
            // å¦‚æœä½ åœ¨ 2025-09-25 ä¹‹å‰æ‰“å¼€ï¼Œå¯èƒ½ä¼šæ˜¾ç¤ºè´Ÿæ•°æˆ–0ï¼Œè¿™é‡Œåšä¸ªç»å¯¹å€¼å¤„ç†æˆ–å‘ä¸Šå–æ•´
            // (1000æ¯«ç§’ * 60ç§’ * 60åˆ† * 24å°æ—¶) = ä¸€å¤©çš„æ¯«ç§’æ•°
            const daysInLove = Math.floor((now - startData) / (1000 * 60 * 60 * 24));

            const goals = ref([]);
            const showModal = ref(false);
            const form = ref({ id: null, title: '', currentVal: 0, targetVal: 100, unit: '' });

            // åŠ è½½åˆ—è¡¨
            const loadGoals = async () => {
                try {
                    const res = await fetch(`${API_BASE}/goals/list`);
                    // å¦‚æœåç«¯è¿”å›çš„ä¸æ˜¯ json æˆ–è€…æŠ¥é”™ï¼Œä¼šè·³åˆ° catch
                    const data = await res.json();
                    
                    if (data && data.length > 0) {
                        goals.value = data;
                    } else {
                        // å¦‚æœåç«¯è¿ä¸Šäº†ä½†æ²¡æ•°æ®ï¼Œæˆ‘ä»¬ä¹ŸæŠ›ä¸ªé”™å»ç”¨æ¼”ç¤ºæ•°æ®ï¼ˆæ–¹ä¾¿ä½ çœ‹æ•ˆæœï¼‰
                        throw new Error("No data");
                    }
                } catch(e) { 
                    console.log("åç«¯è¿æ¥å¤±è´¥æˆ–æ— æ•°æ®ï¼Œä½¿ç”¨æ¼”ç¤ºæ•°æ®", e);
                    // âœ… ä¿®æ”¹ç‚¹ 2ï¼šæ¼”ç¤ºæ•°æ® (Mock Data)
                    // å¦‚æœè¿ä¸ä¸Šæ•°æ®åº“ï¼Œå°±æ˜¾ç¤ºè¿™ä¸ªï¼Œè®©ä½ å…ˆçœ‹åˆ°æ•ˆæœï¼
                    goals.value = [
                        { id: 1, title: 'æ”’é»„é‡‘è®¡åˆ’ (æ¼”ç¤º)', currentVal: 2.5, targetVal: 10, unit: 'g' },
                        { id: 2, title: 'æ‹çˆ±é•¿è·‘ç›®æ ‡ (æ¼”ç¤º)', currentVal: 105, targetVal: 365, unit: 'å¤©' }
                    ];
                }
            };

            // è®¡ç®—ç™¾åˆ†æ¯”
            const getPercent = (goal) => {
                if(!goal.targetVal) return 0;
                let p = (goal.currentVal / goal.targetVal) * 100;
                return p > 100 ? 100 : p.toFixed(1); // ä¿ç•™1ä½å°æ•°
            };

            // æ‰“å¼€å¼¹çª—
            const openModal = (goal = null) => {
                if(goal) {
                    form.value = { ...goal };
                } else {
                    form.value = { id: null, title: '', currentVal: 0, targetVal: 100, unit: '' };
                }
                showModal.value = true;
            };

            // æäº¤ä¿å­˜
            const submitForm = async () => {
                try {
                    await fetch(`${API_BASE}/goals/save`, {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify(form.value)
                    });
                    showModal.value = false;
                    loadGoals(); 
                } catch(e) { 
                    alert('ä¿å­˜å¤±è´¥ï¼ˆå¯èƒ½æ˜¯åç«¯è¿˜æ²¡è¿ä¸Šæ•°æ®åº“ï¼‰ï¼Œä½†ä½ å¯ä»¥çœ‹åˆ°æ¼”ç¤ºæ•ˆæœ'); 
                }
            };

            // åˆ é™¤
            const deleteGoal = async (id) => {
                if(!confirm('ç¡®å®šåˆ é™¤è¿™ä¸ªç›®æ ‡å—ï¼Ÿ')) return;
                try {
                    await fetch(`${API_BASE}/goals/delete/${id}`, { method: 'POST' });
                    loadGoals();
                } catch(e) { alert('åˆ é™¤å¤±è´¥'); }
            };

            onMounted(loadGoals);

            return { 
                daysInLove, goals, showModal, form, 
                getPercent, openModal, submitForm, deleteGoal 
            };
        }
    }).mount('#app');
</script>
</body>
</html>